import { getPayload } from 'payload'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

function isTruthy(v: string | undefined) {
  return v === '1' || v === 'true' || v === 'yes'
}

/**
 * Seed ONLY pages (no products/posts/media).
 * Upserts by slug; updates only when SEED_FORCE=1.
 */
async function seedBarmanPages() {
  if (!process.env.DATABASE_URI || !process.env.PAYLOAD_SECRET) {
    throw new Error('DATABASE_URI and PAYLOAD_SECRET are required')
  }

  const force = isTruthy(process.env.SEED_FORCE)
  const homeSlug = process.env.HOME_PAGE_SLUG || 'home'

  const configPath = path.resolve(__dirname, '../../payload.config.ts')
  const payload = await getPayload({ config: (await import(configPath)).default })

  const galleryMedia = await payload.find({ collection: 'media', limit: 12, sort: '-createdAt' })
  const galleryItems = galleryMedia.docs.map((m: any, index: number) => ({
    image: m.id,
    alt: m.alt || ,
    category: index % 2 === 0 ? 'eventy' : 'imprezy',
    categoryLabel: index % 2 === 0 ? 'Eventy' : 'Imprezy',
  }))


  const pagesData = [
    {
      title: 'Barman na Wynos â€” Strona gÅ‚Ã³wna',
      slug: homeSlug,
      sortOrder: 0,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'hero',
          badge: 'ğŸ¸ Mobilny bar â€¢ Eventy â€¢ Wesela',
          heading: 'Barman na wynos na Twoje wydarzenie',
          subheading: 'Profesjonalny mobilny bar, autorskie koktajle i obsÅ‚uga premium.',
          ctaText: 'Zapytaj o termin',
          ctaLink: '/kontakt',
          secondaryCtaText: 'Zobacz pakiety',
          secondaryCtaLink: '/pakiety',
          showScrollIndicator: true,
          fullHeight: true,
        },
        {
          blockType: 'services',
          heading: 'Co robimy',
          items: [
            { emoji: 'ğŸ‰', title: 'Eventy firmowe', description: 'ObsÅ‚uga barmaÅ„ska na konferencjach i imprezach firmowych.', link: '/oferta' },
            { emoji: 'ğŸ’', title: 'Wesela', description: 'Koktajl bar na weselu â€” elegancko i bez stresu.', link: '/oferta' },
            { emoji: 'ğŸ ', title: 'Imprezy prywatne', description: 'Urodziny, jubileusze, garden party.', link: '/oferta' },
            { emoji: 'ğŸ¹', title: 'Cocktail catering', description: 'Karta koktajli + bezalkoholowe mocktaile.', link: '/cennik' },
          ],
        },
        {
          blockType: 'steps',
          heading: 'Jak to dziaÅ‚a?',
          steps: [
            { emoji: '1ï¸âƒ£', title: 'Kontakt', description: 'Podajesz termin, miejsce i liczbÄ™ goÅ›ci.' },
            { emoji: '2ï¸âƒ£', title: 'Oferta', description: 'Dobieramy pakiet i kartÄ™ koktajli.' },
            { emoji: '3ï¸âƒ£', title: 'Realizacja', description: 'PrzyjeÅ¼dÅ¼amy z barem i robimy robotÄ™.' },
          ],
        },
        {
          blockType: 'cta',
          heading: 'Chcesz wycenÄ™ w 24h?',
          text: 'Napisz do nas â€” wrÃ³cimy z propozycjÄ… pakietu i listÄ… koktajli.',
          buttonText: 'Kontakt',
          buttonLink: '/kontakt',
          variant: 'primary',
          secondaryButtonText: 'Cennik',
          secondaryButtonLink: '/cennik',
        },
        {
          blockType: 'faq',
          heading: 'FAQ',
          items: [
            { question: 'Ile miejsca potrzebujecie na bar?', answer: 'Zazwyczaj 2â€“3 m szerokoÅ›ci + dostÄ™p do prÄ…du (opcjonalnie) i wody.' },
            { question: 'Czy robicie wersje bezalkoholowe?', answer: 'Tak â€” mocktaile oraz opcje dla kierowcÃ³w/dzieci.' },
            { question: 'DziaÅ‚acie poza miastem?', answer: 'Tak â€” dojazd wyceniamy indywidualnie.' },
          ],
        },
      ],
      seo: {
        metaTitle: 'Barman na Wynos â€” mobilny bar na eventy i wesela',
        metaDescription: 'Mobilny bar, koktajle, obsÅ‚uga barmaÅ„ska na eventy firmowe, wesela i imprezy prywatne.',
      },
    },

    {
      title: 'Oferta',
      slug: 'oferta',
      sortOrder: 10,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'hero',
          badge: 'Oferta',
          heading: 'Oferta barmaÅ„ska',
          subheading: 'Pakiety dopasowane do rodzaju wydarzenia i liczby goÅ›ci.',
          ctaText: 'Zobacz pakiety',
          ctaLink: '/pakiety',
          secondaryCtaText: 'Zapytaj o termin',
          secondaryCtaLink: '/kontakt',
        },
        {
          blockType: 'richText',
          content: {
            root: {
              type: 'root', format: '', indent: 0, version: 1, direction: 'ltr',
              children: [
                { type: 'paragraph', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'ObsÅ‚ugujemy eventy firmowe, wesela i prywatne imprezy. Zapewniamy mobilny bar, szkÅ‚o, lÃ³d, dodatki i doÅ›wiadczonych barmanÃ³w.', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
              ],
            },
          },
        },
        {
          blockType: 'cta',
          heading: 'Dopasujemy ofertÄ™ pod budÅ¼et',
          text: 'Wycena zaleÅ¼y od liczby godzin, goÅ›ci, lokalizacji i pakietu.',
          buttonText: 'Kontakt',
          buttonLink: '/kontakt',
          variant: 'primary',
        },
      ],
    },

    {
      title: 'Pakiety',
      slug: 'pakiety',
      sortOrder: 20,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'hero',
          badge: 'Pakiety',
          heading: 'Pakiety mobilnego baru',
          subheading: 'Wybierz wariant i przeÅ›lij termin â€” wrÃ³cimy z finalnÄ… wycenÄ….',
          ctaText: 'Zapytaj o termin',
          ctaLink: '/kontakt',
        },
        {
          blockType: 'pricing',
          heading: 'Pakiety',
          packages: [
            { name: 'Basic', price: 'od â€¦ zÅ‚', featured: false, ctaText: 'Wybieram Basic', ctaLink: '/kontakt?pakiet=basic', features: [{ text: 'Mobilny bar' }, { text: 'Karta koktajli' }, { text: 'ObsÅ‚uga barmana' }] },
            { name: 'Premium', price: 'od â€¦ zÅ‚', featured: true, ctaText: 'Wybieram Premium', ctaLink: '/kontakt?pakiet=premium', features: [{ text: '2 barmanÃ³w' }, { text: 'Koktajle premium' }, { text: 'Dekoracje i garnish' }] },
            { name: 'Signature', price: 'od â€¦ zÅ‚', featured: false, ctaText: 'Wybieram Signature', ctaLink: '/kontakt?pakiet=signature', features: [{ text: 'Autorska karta koktajli' }, { text: 'Strefa barowa' }, { text: 'Opcje 0%' }] },
          ],
        },
      ],
    },

    {
      title: 'Cennik',
      slug: 'cennik',
      sortOrder: 30,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'hero',
          badge: 'Cennik',
          heading: 'Cennik i zakres usÅ‚ug',
          subheading: 'Transparentnie: co jest w pakiecie i od czego zaleÅ¼y cena.',
          ctaText: 'Zapytaj o wycenÄ™',
          ctaLink: '/kontakt',
        },
        {
          blockType: 'richText',
          content: {
            root: {
              type: 'root', format: '', indent: 0, version: 1, direction: 'ltr',
              children: [
                { type: 'paragraph', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'Cena zaleÅ¼y od: liczby godzin, liczby goÅ›ci, lokalizacji, rodzaju alkoholu oraz liczby barmanÃ³w.', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
              ],
            },
          },
        },
      ],
    },

    {
      title: 'Realizacje',
      slug: 'realizacje',
      sortOrder: 40,
      _status: 'published' as const,
      sections: [
        { blockType: 'hero', badge: 'Realizacje', heading: 'Nasze realizacje', subheading: 'ZdjÄ™cia z eventÃ³w, wesel i imprez prywatnych.' },
        { blockType: 'galleryFull', heading: 'Galeria', items: [] },
      ],
    },

    {
      title: 'O nas',
      slug: 'o-nas',
      sortOrder: 50,
      _status: 'published' as const,
      sections: [
        { blockType: 'hero', badge: 'O nas', heading: 'Kim jesteÅ›my', subheading: 'ZespÃ³Å‚ barmanÃ³w z doÅ›wiadczeniem eventowym.' },
        {
          blockType: 'about',
          badge: 'ZespÃ³Å‚',
          heading: 'Bar, ktÃ³ry robi wraÅ¼enie',
          content: {
            root: {
              type: 'root', format: '', indent: 0, version: 1, direction: 'ltr',
              children: [
                { type: 'paragraph', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'PrzyjeÅ¼dÅ¼amy z mobilnym barem, szkÅ‚em, lodem i dodatkami. Dbamy o tempo serwisu i estetykÄ™ koktajli.', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
              ],
            },
          },
          highlights: [{ text: 'DoÅ›wiadczeni barmani' }, { text: 'Autorskie receptury' }, { text: 'Opcje 0%' }, { text: 'Estetyka i tempo' }],
          ctaText: 'Kontakt',
          ctaLink: '/kontakt',
        },
      ],
    },

    {
      title: 'FAQ',
      slug: 'faq',
      sortOrder: 60,
      _status: 'published' as const,
      sections: [
        { blockType: 'hero', badge: 'FAQ', heading: 'NajczÄ™stsze pytania', subheading: 'Szybkie odpowiedzi przed zapytaniem.' },
        {
          blockType: 'faq',
          heading: 'FAQ',
          items: [
            { question: 'Czy zapewniacie alkohol?', answer: 'ZaleÅ¼nie od ustaleÅ„ â€” moÅ¼emy dziaÅ‚aÄ‡ na alkoholu klienta lub w modelu kompleksowym.' },
            { question: 'Ile trwa obsÅ‚uga?', answer: 'Standardowo 3â€“6h, ale dopasowujemy do harmonogramu.' },
            { question: 'Czy wystawacie fakturÄ™?', answer: 'Tak.' },
          ],
        },
      ],
    },

    {
      title: 'Kontakt',
      slug: 'kontakt',
      sortOrder: 70,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'contactForm',
          heading: 'Kontakt',
          subheading: 'Podaj termin, lokalizacjÄ™ i liczbÄ™ goÅ›ci â€” wrÃ³cimy z ofertÄ….',
        },
      ],
    },

    {
      title: 'Regulamin',
      slug: 'regulamin',
      sortOrder: 80,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'legalText',
          heading: 'Regulamin',
          effectiveDate: new Date().toISOString().slice(0, 10),
          content: {
            root: {
              type: 'root', format: '', indent: 0, version: 1, direction: 'ltr',
              children: [
                { type: 'heading', tag: 'h2', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'Â§1 Postanowienia ogÃ³lne', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
                { type: 'paragraph', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'Regulamin Å›wiadczenia usÅ‚ug barmaÅ„skich (szablon) â€” uzupeÅ‚nij pod swÃ³j podmiot.', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
              ],
            },
          },
        },
      ],
    },

    {
      title: 'Polityka prywatnoÅ›ci',
      slug: 'polityka-prywatnosci',
      sortOrder: 90,
      _status: 'published' as const,
      sections: [
        {
          blockType: 'legalText',
          heading: 'Polityka prywatnoÅ›ci',
          effectiveDate: new Date().toISOString().slice(0, 10),
          content: {
            root: {
              type: 'root', format: '', indent: 0, version: 1, direction: 'ltr',
              children: [
                { type: 'heading', tag: 'h2', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'Â§1 Informacje ogÃ³lne', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
                { type: 'paragraph', format: '', indent: 0, version: 1, direction: 'ltr',
                  children: [{ type: 'text', text: 'Polityka prywatnoÅ›ci (szablon) â€” uzupeÅ‚nij o dane administratora, cele i podstawy prawne.', format: 0, version: 1, detail: 0, mode: 'normal', style: '' }],
                },
              ],
            },
          },
        },
      ],
    },
  ] as const

  for (const pageData of pagesData) {
    const existing = await payload.find({ collection: 'pages', where: { slug: { equals: pageData.slug } }, limit: 1 })
    if (existing.docs[0]) {
      if (force) {
        await payload.update({ collection: 'pages', id: existing.docs[0].id, data: pageData as never })
      }
    } else {
      await payload.create({ collection: 'pages', data: pageData as never })
    }
  }

  console.log('âœ… Barman pages seed complete')
}

seedBarmanPages().catch((err) => {
  console.error('âŒ Seed failed:', err)
  process.exit(1)
})
